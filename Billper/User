from Billper.Group import Group


class User:
    __slots__ = ("username", "password", "balance", "visible", "group")

    def __init__(self, username, password):
        '''
        if check_username(username):   # check if this username has already been used in server
            print("This username has already been used")
        '''
        self.username = username
        self.password = password
        self.balance = 0
        self.group = dict()
        self.visible = False

# pull data from server after log in!!!!!!!
    def log_in(self, username, password):   # return type is boolean
        if self.visible:
            print("You have already logged in!")
            return
        if self.username == username and self.password == password:
            self.visible = True
            return True
        self.visible = False
        return False

    def log_out(self):
        if not self.visible:
            self.visit_deny()
            return
        self.visible = False

    def get_username(self):
        return self.username

    def balance_in(self, money):
        if not self.visible:
            self.visit_deny()
            return
        self.balance += money

    def balance_out(self, money):  # return type is float, amount of money out
        balance = self.balance - money
        if not self.visible:
            self.visit_deny()
            return
        if balance < 0:
            print("Not sufficient funds")
            return False
        else:
            self.balance = balance
            return True

    def get_balance(self):
        if not self.visible:
            self.visit_deny()
            return
        balance = self.balance
        return balance

    def create_group(self, group_name, size, term):
        if not self.visible:
            self.visit_deny()
            return
        group = Group(group_name, size, term, self)
        group.add_user(self)

    def add_group(self, group_num, group):
        if not self.visible:
            self.visit_deny()
            return
        if not group.check_user(self):
            print("Group needs to add you first")
            return
        self.group[group_num] = group
        print(self.get_username(), "Added to", group.get_group_name())

    def get_group(self, group_num):
        if not self.visible:
            self.visit_deny()
            return
        if group_num in self.group:
            return self.group[group_num]
        print("You are not in that group!")
        return

    def get_group_name_list(self):
        if not self.visible:
            self.visit_deny()
            return
        group_num = list(self.group.keys())
        group_name = list()
        for num in group_num:
            group_name.append(self.group[num].get_group_name())
        return group_name

    def get_group_num_list(self):
        if not self.visible:
            self.visit_deny()
            return
        group_num = list(self.group.keys())
        return group_num

    def delete_group(self, group_num):
        if not self.visible:
            self.visit_deny()
            return
        if group_num in self.group:
            group = self.group[group_num]
            if group.check_user(self):
                print("Group needs to delete you first")
                return
            self.group.pop(group_num)
            return
        else:
            print("You are not in that group!")
            return

    def vote(self, request):
        #use user input
        vote = True
        request.add_user_vote(self, vote)   #write this method

    # def add_group_request(self):

    @staticmethod
    def visit_deny():
        print("Account cannot be visited!")

# need to update


def main():
    user1 = User("sean", "12345")
    user1.log_in("sean", "12345")
    user1.create_group("qqq", 10, 30)
    print(user1.get_group_num_list())


if __name__ == "__main__":
    main()
